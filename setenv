export ROOT="$(readlink -f $(dirname "$BASH_SOURCE"))/.."
SOURCEDIR="$ROOT/sources"
source $SOURCEDIR/poky/oe-init-build-env "$@"

# check if bblayers.conf has been already updated
grep --quiet "Generated by setup script" conf/bblayers.conf
if [ $? -eq 0 ]; then
	echo "conf/bblayers.conf up-to-date"
else
# add meta-raspberrypi and meta-openembedded paths to bblayer.conf
cat >> "conf/bblayers.conf" <<EOF

# Generated by setup script
BBLAYERS += "${SOURCEDIR}/meta-raspberrypi"
BBLAYERS += "${SOURCEDIR}/meta-openembedded/meta-oe"
BBLAYERS += "${SOURCEDIR}/meta-openembedded/meta-networking"
BBLAYERS += "${SOURCEDIR}/meta-openembedded/meta-multimedia"
BBLAYERS += "${SOURCEDIR}/meta-openembedded/meta-python"
EOF
fi

# check if local.conf has been already updated
grep --quiet "Generated by setup script" conf/local.conf
if [ $? -eq 0 ]; then
	echo "conf/local.conf up-to-date"
else
# add "commercial" licenses exception to local.conf
cat >> "conf/local.conf" <<EOF

# Generated by setup script
LICENSE_FLAGS_WHITELIST = "commercial"
EOF
fi

# print usage example
cat <<EOM

### RaspberryPi build ###
 
MACHINE=raspberrypi bitbake rpi-hwup-image

EOM

