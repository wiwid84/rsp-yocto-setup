if [ -n "$BASH_SOURCE" ]; then
	export ROOT=$(readlink -f $(dirname "$BASH_SOURCE"))
else
	export ROOT=$(readlink -f ${PWD})
fi

SOURCEDIR="$ROOT/sources"

source $ROOT/sources/poky/oe-init-build-env "$@"

metas=$(find "$SOURCEDIR" -path "*-raspberrypi/conf/layer.conf")

# add meta-raspberrypi path to bblayer.conf file
for meta in ${metas}; do
	metaloc=${meta%/conf/layer.conf}
	result=$(grep -o "$metaloc" "conf/bblayers.conf")
	if [ -z "$result" ]; then
		cat >> "conf/bblayers.conf" <<EOF
# Generated by setup script
BBLAYERS += "$metaloc"
EOF
	fi
done

cat <<EOM
 
### RaspberryPi build ###
 
MACHINE=raspberrypi bitbake rpi-hwup-image

EOM

